$(function(){var i=$('[type="checkbox"][name="filter"]'),n=$("#view_data_container"),r=function(){var t=$('.nav-tabs a[data-toggle="tab"]:first',n);t.tab("show")},u,t,f;$("#accordion .panel-body").css({"max-height":$(window).height()-390,overflow:"auto"});n.css({"max-height":$(window).height()-120,overflow:"auto"});u=function(n,t){var i=n.data("load_detail");if(!i||i==undefined||i.length==0){t.html('<div class="well well-sm">没有数据！<\/div>');return}t.setTemplate('<ul class="list-unstyled">{#foreach $T as record}<li><div class="checkbox"><label><input type="checkbox" data-url="{$T.record.url}" value="{$T.record.id}" />{$T.record.name}<\/label> <span class="label label-primary getFileDetail" data-loaded="false" data-id="{$T.record.id}">详细信息<\/span><\/div><\/li>{#/for}<\/ul>');t.processTemplate(i)};$(document).on("shown.bs.tab",'a[data-loadproduct="true"][data-toggle="tab"]',function(t){var r=$(t.target),f,e;r.attr("data-loaded")!="true"&&(f=$("#lang_"+r.data("id"),n),f.html('<i class="icon-spinner icon-spin"><\/i>'),r.attr("data-loading")!="true")&&(r.attr("data-loading","true"),e=$(".category li.active:first"),$.post("/Category/GetList",{id:e.data("id"),lang:r.data("id"),filter:i.prop("checked")},function(n){n.status&&(r.data("load_detail",n.result),u(r,f),r.attr("data-loaded","true"),r.attr("data-loading","false"))}))});$("#search_form").on("submit",function(){var t=$(this),u=$.trim($('[name="keyword"]',t).val()||"");return u==""?(alert("搜索关键字不能为空"),!1):t.attr("data-loading")=="true"?!1:(n.html('<i class="icon-spinner icon-spin"><\/i>'),t.attr("data-loading","true"),$.post("/Category/Search",{keyword:u,filter:i.prop("checked")},function(i){if(i.status){var u=i.result;if(!u||u==undefined||u.length==0){n.html('<div class="well well-sm">没有数据！<\/div>');return}n.setTemplate('{#if $T.toomany}<div class="well well-sm" style="margin-bottom:9px;">搜索结果太多，仅显示最新发布前50条！<\/div>{#/if}<ul class="nav nav-tabs">{#foreach $T.list as record}<li><a href="#lang_{$T.record.id}" data-loadproduct="false" data-loaded="false" data-id="{$T.record.id}" data-toggle="tab">{$T.record.lang}<\/a><\/li>{#/for}<li><a href="#select_data_box" data-toggle="tab">已勾选(<span>0<\/span>)<\/a><\/li><\/ul><div class="tab-content">{#foreach $T.list as record}<div class="tab-pane" id="lang_{$T.record.id}"><ul class="list-unstyled">{#foreach $T.record.product as product}<li><div class="checkbox"><label><input type="checkbox" data-url="{$T.product.url}" value="{$T.product.id}" />{$T.product.name}<\/label> <span class="label label-primary getFileDetail" data-loaded="false" data-id="{$T.product.id}">详细信息<\/span><\/div><\/li>{#/for}<\/ul><\/div>{#/for}<div class="tab-pane" id="select_data_box"><\/div><\/div>');n.processTemplate(u);r()}else n.html('<div class="alert alert-danger well-sm">'+i.message+"<\/div>");t.attr("data-loading","false")}),!1)});$("#search_form input").on("keydown",function(){if(event.keyCode===13){var n=$(this).parents("form:first");return $('[type="submit"]',n).click(),!1}});$("#accordion").on("shown.bs.collapse",function(n){var f=$(n.target),r=f.parents(".panel:first"),t=$('[data-loadmenu="true"]',r),u,i;t&&t.length!=0&&(u=t.data("menuid"),i=$(".panel-body",r),$.post("/Category/Index",{id:u},function(n){i.setTemplate('<ul class="list-unstyled category ">{#foreach $T as record}<li data-id="{$T.record.id}" data-loaded="false" title="{$T.record.name}">{$T.record.name} <i class="icon-spinner icon-spin"><\/i><\/li>{#/for}<\/ul>');i.processTemplate(n);t.removeAttr("data-loadmenu")}))});t=function(t){var i=t.data("load_detail");if(!i||i==undefined||i.length==0){n.html('<div class="well well-sm">没有数据！<\/div>');return}n.setTemplate('<ul class="nav nav-tabs">{#foreach $T as record}<li><a href="#lang_{$T.record.id}" data-loadproduct="true" data-loaded="false" data-id="{$T.record.id}" data-toggle="tab">{$T.record.lang}<\/a><\/li>{#/for}<li><a href="#select_data_box" data-toggle="tab">已勾选(<span>0<\/span>)<\/a><\/li><\/ul><div class="tab-content">{#foreach $T as record}<div class="tab-pane" id="lang_{$T.record.id}"><\/div>{#/for}<div class="tab-pane" id="select_data_box"><\/div><\/div>');n.processTemplate(i);r()};$(document).on("click",".category li",function(){var i=$(this),r;if(!i.is(".active")){if(n.html('<i class="icon-spinner icon-spin"><\/i>'),r=i.parents("#accordion:first"),$("li.active",r).removeClass("active"),i.addClass("active"),i.attr("data-loaded")=="true"){t(i);return}i.attr("data-loading")!="true"&&(i.attr("data-loading","true"),$.post("/Category/GetLang",{id:i.data("id")},function(n){n.status&&(i.data("load_detail",n.result),t(i),i.attr("data-loaded","true"),i.attr("data-loading","false"))}))}});$(n).on("click",".getFileDetail",function(){var n=$(this),i=n.parents("li:first"),t;if(n.attr("data-loaded")=="true"){$("div.detail",i).toggle();return}(t=$("div.detail",i),t&&t.length!=0||(t=$('<div class="detail"><i class="icon-spinner icon-spin"><\/i><\/div>'),i.append(t)),n.attr("data-loading")!="true")&&(n.attr("data-loading","true"),$.post("/Category/GetProduct",{id:n.data("id")},function(i){i.status&&(t.setTemplate('<dl class="dl-horizontal"><dt>文件名<\/dt><dd>{$T.FileName}<\/dd><dt>SHA1<\/dt><dd>{$T.SHA1}<\/dd><dt>文件大小<\/dt><dd>{$T.size}<\/dd><dt>发布时间<\/dt><dd>{$T.PostDateString}<\/dd><\/dl><pre>{$T.DownLoad}<\/pre>'),t.processTemplate(i.result),n.attr("data-loaded","true"),n.attr("data-loading","false"))}))});f=function(){var t=$("#select_data_box pre.url",n);return t.length};$(n).on("click","input[type='checkbox']",function(){var i=$(this),r=i.val(),o=i.data("url"),u=$("#select_data_box",n),t=$('pre.url[id="url_'+r+'"]',u),e;i.prop("checked")?t&&t.length!=0||u.append('<pre class="url" id="url_'+r+'">'+o+"<\/pre>"):t&&t.length>0&&t.remove();e=f();$('a[href="#select_data_box"] span',n).text(e)})})